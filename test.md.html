<meta charset="utf-8" lang="en">

<!-- TODO improve titlepage: make a class for this, set height to 100%, use flex or something for spacing -->
<section class="title-page">
    <div class="title-page-top">
        <big>Eberhard Karls Universität Tübingen</big><br>
        Mathematisch-Naturwissenschaftliche Fakultät<br>
        Wilhelm-Schickard-Institut für Informatik<br>
    </div>
    <div class="title-page-middle">
        <big>Master's Thesis in Media Informatics</big>
        <br><br>
        <span style="font-family: var(--heading-font); font-weight: bold; font-size: 3.25rem;" id="thesis-title">UnicodeMath ⥅ MathML</span>
        <br><br><br>
        <big>Noah Doersing</big>
        <br><br>
        *November 30, 2019*
    </div>
    <div class="title-page-bottom">
        <div style="display: inline-block; margin-right: 2em; vertical-align: top;">
            **Reviewers:**
        </div>
        <div style="display: inline-block; margin-right: 2em; vertical-align: top;">
            Prof. Dr. Torsten Grust<br>
            Database Systems Research Group<br>
            Wilhelm-Schickard-Institut für Informatik<br>
            University of Tübingen
        </div>
        <div style="display: inline-block; margin-right: 2em; vertical-align: top;">
            Prof. Dr. TODO<br>
            TODO Research Group<br>
            Wilhelm-Schickard-Institut für Informatik<br>
            University of Tübingen
        </div>
    </div>
</section>

---

(##) Abstract

test

<br><br>

(###) Notes

This document was generated... TODO markdeep (morgan), bindery, fonts, unicodemath/murray, mathml, torsten, etc.

---

# Introduction
> "This is a quote."
>
>      -- This quote

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

```latex
$E = mc^2$
```

* a list of items
* more

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo.

> "Consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
> Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
> tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
> qu is nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
> consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
> cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
> proident, sunt in culpa qui officia deserunt mollit anim id est laborum."


cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

!!!
    I'm a note. Don't mind me, I'm just sitting here.

!!! note
    Another note.

!!! Tip
    Close the door on the way out.

!!! WARNING
    I'm a warning, perhaps. *Something might happen!*

!!! ERROR: Seriously
    Watch out, something **bad** could happen.

    This is still more error text.

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ C linenumbers
void insertion_sort(int data[], int length) {
    for (int i = 0; i < length; ++i) {
       ...
    }
}
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum. [#Kajiya86]

## testing this thing

test

### testing more

test

#### testing all the much

1. test
2. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
3. test

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in *volufptate* **velit** esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.

```sql linenumbers
-- Combine possible_movements and the board_and_pieces to create the final result.
-- Result:
-- x : The x coordinate on the board.
-- y : The y coordinate on the board.
-- piece_id: Is either the id of a positioned piece or NULL, if no piece is on that square.
-- descr: The visual representation of a piece, 'O' or ' '. See board_and_pieces and possible_movements.  Type: CHAR(1).
board_result (x,y,piece_id,descr) AS (
  SELECT pb.x AS x, pb.y AS y,
         string_to_array(STRING_AGG(pb.piece_id, ','), ',') AS piece_id, -- List all ids without NULL (ARRAY_AGG would list with NULLs).
         MAX(pb.descr) AS descr -- Use MAX(...) because: ' ' < 'O' < any unicode chesspiece.
  FROM (
   TABLE possible_movements
     UNION
   TABLE board_and_pieces
  ) AS pb
  GROUP BY pb.y, pb.x
  ORDER BY pb.y DESC, pb.x
)
-- List in a chess board like fashion.
SELECT br.y AS " ", ARRAY_TO_STRING(ARRAY_AGG(br.descr ORDER BY br.x), '|') AS "A B C D E F G H "
  FROM board_result AS br
GROUP BY br.y
ORDER BY br.y DESC;
```

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse

Cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident.

Sunt in culpa qui officia deserunt mollit anim id est laborum.
Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis!

Aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur.

Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia.

Deserunt mollit anim id est laborum – lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

# Overview

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

$$E = mc^2$$

<!--Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ test Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.-->

$E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit
$E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo

$E = mc^2$ consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum. $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$

consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

**************************************************************************
*                    ____                      *                         *
*                   |    |_____.---.           |                         *
*                   o     _____|    )----------)-------.                 *
*                  / \   |     '---'           |     __|__               *
*                 /___\  |                     |     \   /               *
*                   |    '-------------.       |      \ /                *
* A ----------------'                  |       |       o                 *
*      .-------------------.     o-----)-------'       |                 *
*      |                   |___.---.   |               |___.---.         *
* B ---*---.__.---.         ___|    )--*--.__..---.     ____)   )----- Y *
*           __|    o----*--'   '---'    ______))   )---'   '---'         *
* C -------'  '---'     |              |     ''---'                      *
*                       |              o                                 *
*                       |             / \                     test       *
*                       |            /___\                               *
*                       |              |                                 *
*                       '--------------'                                 *
**************************************************************************

test

![Figure [robot]: A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot ](https://images-na.ssl-images-amazon.com/images/I/61R2%2Bfcus9L._SY679_.jpg width="200")

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore Figure [robot] et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

testting [^test] testingg [^test]

test [^test2]

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum. [^test2]

# Vessels

𐃢𐃤𐃭𐃣𐃯𐃰𐃪𐃥𐃦𐃡𐃨𐃩

## This is a very long headline lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo!

### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test

## test

# test

## test

(#) Bibliography

[#Kajiya86]: James T. Kajiya. 1986. The Rendering Equation. In _Proceedings of Computer Graphics and Interactive Techniques (SIGGRAPH '86)_, ACM, 143-150. http://dx.doi.org/10.1145/15922.15902

---

<div style="width: 70%; margin: 5rem auto 0;">
    (##) Selbstständigkeitserklärung

    Hiermit versichere ich gemäß § 17 Absatz 4 des allgemeinen Teils der geltenden Prüfungsordnung, dass ich diese Arbeit selbständig verfasst, keine anderen als die angegebenen Hilfsmittel und Quellen benutzt habe, alle wörtlich oder sinngemäß aus anderen Werken übernommenen Aussagen als solche gekennzeichnet habe und dass die Arbeit weder vollständig noch in wesentlichen Teilen Gegenstand eines anderen Prüfungsverfahrens gewesen ist sowie dass ich die Arbeit weder vollständig noch in wesentlichen Teilen bereits veröffentlicht habe und dass das in Dateiform eingereichte Exemplar mit den eingereichten gebundenen Exemplaren übereinstimmt.

    <br><br>
    <div style="width: 80%; border-bottom: 0.1em solid black; margin-bottom: 0.4em;"></div>
    <span style="font-family: var(--reference-font)">Datum, Ort, Unterschrift</span>
</div>

[^test]: Testing endnote

[^test2]: Lorem ipsum *dolor* sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

<link rel="stylesheet" href="reset.css">
<link rel="stylesheet" href="style.css">

<script>
    // collect endnotes, write as data attributes into the references to them
    function processEndnotes() {

        // find all references to end notes
        var references = Array.from(document.querySelectorAll("sup > a[href^='#endnote-']"));
        var endnotes = [];
        references.forEach(function (element) {

            // get endnote
            var endnoteName = element.getAttribute("href").substr(1);
            var endnote = document.querySelector("a[name=\"" + endnoteName + "\"]").parentNode;

            // store for later removal
            if (!endnotes.includes(endnote)) {
                endnotes.push(endnote);
            }

            // remove the unneeded reference number
            endnote = endnote.cloneNode(true);
            //endnote.childNodes[0].remove();
            endnote.childNodes[1].remove();

            // base64-endcode
            var endnoteEncoded = window.btoa(endnote.innerHTML);
            element.setAttribute("data-footnote-content", endnoteEncoded);

            // prepare endnote reference for later processing in bindery
            element.classList.add("footnote-reference");
            element.innerHTML = "";
            element.parentNode.parentNode.replaceChild(element, element.parentNode);
        });

        // remove endnotes
        endnotes.forEach(function(element) {
            element.parentNode.removeChild(element);
            // TODO element.remove();?
        });
    }

    // coerce the table of contents into a format more suitable for filling in page numbers
    function processTOC() {

        // extract toc entries
        var toc = document.getElementsByClassName("longTOC")[0].childNodes[1];
        var tocEntries = [];
        toc.childNodes.forEach(function (element) {

            // ignore <br>s and (Top) link
            if (element.tagName && element.tagName.toLowerCase() == "a" && !element.classList.contains("tocTop")) {
                tocEntries.push(element);
            }
        });

        // generate new toc
        newToc = document.createElement("ol");
        tocEntries.forEach(function (element) {

            // extract heading level
            var level = element.classList[0];
            element.removeAttribute("class");

            // replace href with unique, tocN.N-style target
            var tocN = element.querySelector("span").innerHTML;
            tocN = "toc" + tocN.split("&nbsp;")[0];
            element.setAttribute("href", "#" + tocN);

            // assemble new toc entry
            var row = document.createElement("li");
            row.classList.add(level);
            var span = document.createElement("span");
            span.appendChild(element);
            row.appendChild(span);

            newToc.appendChild(row);
        });

        // replace old toc with new one
        toc.parentNode.replaceChild(newToc, toc);

        // each heading the text has three anchors in front of it, of the format
        // name, supersectionname/.../name, and tocN.N. the toc (now) links to
        // the last one, so pull this one into the heading. (since the anchors
        // frequently end up on the page before the heading after bindery is
        // done processing)
        var headings = document.querySelectorAll(".md h1, .md h2, .md h3");
        headings.forEach(function (element) {
            var anchor = element.previousSibling;
            anchor = anchor.cloneNode(true);
            anchor.classList.add("heading-target");
            element.appendChild(anchor);
        });
    }

    // ~~read computed line numbers~~ generate line numbers in js and write
    // them, thus keeping them from restarting when a code block is split onto
    // multiple pages by bindery
    function solidifyCodeLinenumbers() {
        document.styleSheets[0].addRule('.md pre.listing .linenumbers span.line:before', 'content: attr(data-linenumber) !important;');
        document.querySelectorAll("pre .linenumbers").forEach(function (element) {
            var i = 1;
            element.querySelectorAll(".line").forEach(function (element) {
                var linenumber = i++;
                element.setAttribute("data-linenumber", linenumber);
            });
        });
    }

    function loadMathJaxAndThenBindery() {
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src  = "lib/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_SVG";

        var config = 'MathJax.Hub.Config({' +
                        'extensions: ["tex2jax.js"],' +
                        'jax: ["input/TeX","output/SVG"]' +
                     '});' +
                     'MathJax.Hub.Startup.onload();' +
                     'MathJax.Hub.Register.StartupHook("End",function () {' +
                        'console.log(document.querySelector(".md"));' +
                        'postprocessMathJax();' +
                        'loadBindery();' +
                     '});';
        // for reference, see https://docs.mathjax.org/en/v1.1-latest/startup.html#startup-sequence
        // https://github.com/mathjax/mathjax-docs/wiki/Event-when-typesetting-is-done%3F-Rescaling-after-rendering...

        if (window.opera) {script.innerHTML = config}
        else {script.text = config}

        document.getElementsByTagName("head")[0].appendChild(script);
    }

    function postprocessMathJax() {
        // TODO pull out svgs, remove the rest, to ideally remove the bindery page breaking issues
        var svgs = document.querySelectorAll(".MathJax_SVG svg");
        svgs.forEach(function (element) {
            element.parentNode.parentNode.replaceChild(element, element.parentNode);
        });
        document.querySelectorAll(".MathJax_Preview").forEach(e => e.remove());
        document.querySelectorAll("script[type='math/tex']").forEach(e => e.remove());
    }

    function loadBindery() {
        var book = Bindery.makeBook({
            content: '.md',
            pageSetup: {
                size: { width: '21cm', height: '29.7cm' },
                margin: { top: '2cm', inner: '3cm', outer: '2cm', bottom: '2cm' },
            },
            printSetup: {
                layout: Bindery.Layout.PAGES,
                paper: Bindery.Paper.AUTO,
                marks: Bindery.Marks.NONE,
                bleed: '0pt',
            },
            view: Bindery.View.PREVIEW,
            //view: Bindery.View.PRINT,
            //view: Bindery.View.FLIPBOOK,
            rules: [
                Bindery.FullBleedPage({
                    selector: '.title-page',
                    continue: 'same'
                }),
                Bindery.PageBreak({ selector: 'h1', position: 'before', continue: 'right' }),
                Bindery.PageBreak({ selector: '.nonumberh1', position: 'before', continue: 'right' }),
                Bindery.PageBreak({ selector: 'hr', position: 'before', continue: 'right' }),
                Bindery.PageBreak({ selector: '.image', position: 'avoid'}),  // figures
                Bindery.RunningHeader({
                    render: function (page) {
                        var pageNum = page.number-2;

                        if (page.isEmpty || pageNum <= 0) {
                            return "";
                        }
                        if (page.isLeft) {
                            if (page.heading.h1 != null) {
                                return `${pageNum}⁓${page.heading.h1}`  // alternatives: ⸺, ⸻
                            }
                            return `${pageNum}`
                        } else {
                            return `Noah Doersing⁓${pageNum}`;
                        }
                    }
                }),
                Bindery.Footnote({
                    selector: 'a.footnote-reference',
                    render: function (element, number) {
                        return "<sup>" + number + "</sup>" + window.atob(element.getAttribute("data-footnote-content"));
                    }
                }),
                Bindery.PageReference({
                    selector: '.longTOC li',
                    replace: (element, number) => {
                        var pageNum = number-2;

                        element.innerHTML += `<span class='num'>${pageNum}</span>`;
                        return element;
                    },
                    createTest: function (element) {
                        const href = element.querySelector("a").getAttribute('href');
                        if (!href) return null;
                        return el => el.querySelector("a.target.heading-target[name='" + href.substr(1) + "']");
                    }
                })
            ],
        });
        //console.log(book);
        tryRestoringScrollPosition();
    }

    // restore scroll position after page reload
    // (via torsten's slides)
    window.onbeforeunload = function() {
        window.name = window.pageYOffset;
    };

    // wait until bindery appears to be done, then wait another 100ms for good measure
    function tryRestoringScrollPosition() {
        var to = setInterval(function() {
            //console.log("tryin'");
            var retry = true;
            try {
                retry = document.querySelector(".📖-root").classList.contains("📖-in-progress");
            } catch(e) {}

            if (!retry && window.name.search("^\\d+$") == 0) {
                clearInterval(to);
                setTimeout(function() {
                    window.scrollTo(0, window.name);
                }, 100);  // <- this constant might need adjusting for more complex documents!
            }
        }, 10);
    }

    markdeepOptions = {
        tocStyle: 'long',
        detectMath: false,
        onLoad: function() {

            // preprocess
            processEndnotes();
            processTOC();
            solidifyCodeLinenumbers();
            document.querySelectorAll(".md p").forEach(e => e.innerHTML.trim() == "" ? e.remove() : null);

            loadMathJaxAndThenBindery();
        }
    };
</script>
<script src="lib/bindery/2.2.8/bindery.min.js"></script>
<script src="lib/markdeep/1.06/markdeep.min.js" charset="utf-8"></script>
